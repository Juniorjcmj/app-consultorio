<p-card>
  <p-toast></p-toast>
  <!-->Inicio do formulario de filtros-->
  <p-accordion>
    <p-accordionTab header="FILTRO AVANÇADO">
      <form [formGroup]="formFilter" style="margin-top:10px">
      <div class="grid p-fluid">
        <div class="col-12 md:col-3">
          <div class="" >
            <label for="dataSaidaInicial">DATA INÍCIO</label>
            <input type="date" inputId="dataSaidaInicial" pInputText placeholder="DATA INÍCIO"
            formControlName="dataSaidaInicial" name="dataSaidaInicial" >
                   </div>
        </div>
        <div class="col-12 md:col-3">
          <div class="">
            <label for="dataSaidaFinal">DATA FIM</label>
            <input type="date" inputId="dataSaidaFinal" pInputText placeholder="DATA FIM"
            formControlName="dataSaidaFinal" name="dataSaidaFinal" >
          </div>
        </div>

        <div class="col-12 md:col-3">
          <div class="">
            <label for="numeroPedido">Nº DO PEDIDO</label>
            <input type="text" inputId="numeroPedido" pInputText placeholder="Ex: 256987" formControlName="numeroPedido" name="numeroPedido" >
          </div>
        </div>
        <div class="col-12 md:col-3">
          <label for="idViatura">VIATURA</label>
            <p-multiSelect inputId="idViatura"  [options]="viaturas" formControlName="idViatura" name="idViatura"
               optionLabel="placa" optionValue="id" >
            </p-multiSelect>
        </div>
        <div class="col-12 md:col-3">
          <label for="idColaboradorResponsavel">RESPONSÁVEL</label>
            <p-multiSelect inputId="idColaboradorResponsavel"  [options]="colaboradores" formControlName="idColaboradorResponsavel" name="idColaboradorResponsavel"
               optionLabel="nome" optionValue="id" >
            </p-multiSelect>
        </div>
        <div class="col-12 md:col-3">
          <label for="idColaboradorMotorista">MOTORISTA</label>
            <p-multiSelect inputId="idColaboradorMotorista"  [options]="colaboradores" formControlName="idColaboradorMotorista" name="idColaboradorMotorista"
               optionLabel="nome" optionValue="id" >
            </p-multiSelect>
        </div>

  <div class="col-12 md:col-3">
    <div class="p-inputgroup" style="margin-top:20px ;">
        <button label="LIMPAR" type="button" pButton pRipple icon="pi pi-eraser" (click)="resetarFiltro()" class="p-button-secondary mb-2"
        ></button>
    </div>
  </div>
  <div class="col-12 md:col-3">
    <div class="p-inputgroup" style="margin-top:20px ;">
        <button label="FILTRAR" type="button" pButton pRipple icon="pi pi-filter" (click)="filtroAvancadissimo()"
        [disabled]="!formFilter.valid"
        ></button>
    </div>
  </div>


      </div>
      </form>
    </p-accordionTab>
  </p-accordion>

  <!--Fim do formulario de filtros-->



  <div id="htmlData">
    <div class="card">
      <p-toolbar styleClass="mb-4">
        <ng-template pTemplate="left">
          <button pButton pRipple label="Nova" icon="pi pi-plus" class="p-button-warning  p-button-sm" pTooltip="CRIAR NOVA OPERADORA"
            (click)="openNew()"></button>
        </ng-template>

        <ng-template pTemplate="right">
          <p-image src="assets/icons/xlsx.png" alt="Image" width="50px" pTooltip="Extrair tabela XLS" tooltipPosition="bottom" (click)="exportexcel()"></p-image>

          <p-divider layout="vertical"></p-divider>

          <p-image src="assets/icons/pdf.png" alt="Image" width="50px" pTooltip="Extrair tabela PDF" tooltipPosition="bottom" (click)="exportPdf()"></p-image>
        </ng-template>
      </p-toolbar>


      <p-table #dt [value]="pagina" [rows]="100" [paginator]="true" [rowsPerPageOptions]="[25,50]" id="excel-table"
        [globalFilterFields]="['dataSaida','motorista','responsavel', 'status']"
        responsiveLayout="scroll" [(selection)]="selected" [rowHover]="true" dataKey="id"
        currentPageReportTemplate="Mostrando {first} até {last} de {totalRecords} Entregas" [showCurrentPageReport]="true">
        <ng-template pTemplate="caption">
          <div class="flex align-items-center justify-content-between">
            <span class="p-input-icon-left">
              <i class="pi pi-search"></i>
              <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                placeholder="Pesquisar..." />
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>

            <th pSortableColumn="id">ID<p-sortIcon field="aute"></p-sortIcon></th>
            <th pSortableColumn="dataSaida">DATA SAÍDA<p-sortIcon field="dataSaida"></p-sortIcon></th>
            <th pSortableColumn="horaSaida">HORA SAÍDA <p-sortIcon field="horaSaida"></p-sortIcon></th>
            <th pSortableColumn="horaChegada">HORA CHEGADA <p-sortIcon field="horaChegada"></p-sortIcon></th>
            <th pSortableColumn="responsavel">RESPONSÁVEL <p-sortIcon field="responsavel"></p-sortIcon></th>
            <th pSortableColumn="motorista">MOTORISTA <p-sortIcon field="motorista"></p-sortIcon></th>
            <th pSortableColumn="status">STATUS <p-sortIcon field="status"></p-sortIcon></th>
            <th pSortableColumn="odometroSaida">ODÔMETRO SAÍDA <p-sortIcon field="odometroSaida"></p-sortIcon></th>
            <th pSortableColumn="odometroChegada">ODÔMETRO CHEGADA <p-sortIcon field="odometroChegada"></p-sortIcon></th>
            <th pSortableColumn="kmRodados">KM RODADO <p-sortIcon field="kmRodados"></p-sortIcon></th>
            <th pSortableColumn="descricao">DESCRIÇÃO <p-sortIcon field="descricao"></p-sortIcon></th>

            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-entregaTable>
          <tr>
            <td>{{entregaTable.id}}</td>
            <td>{{entregaTable.dataSaida | date : 'dd/MM/yyyy'}}</td>
            <td>{{entregaTable.horaSaida}}</td>
            <td  (click)="editChegada(entregaTable)" >{{entregaTable.horaRetorno }}</td>
            <td>{{entregaTable.responsavel?.nome }}</td>
            <td>{{entregaTable.motorista?.nome }}</td>
            <td>{{entregaTable.status }}</td>
            <td>{{entregaTable.odometroSaida}}</td>
            <td>{{entregaTable.odometroEntrada}}</td>
            <td>{{entregaTable.kmRodados}}</td>
            <td>{{entregaTable.descricao }}</td>
            <td>
              <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-text p-button-lg p-button-primary mr-2" pTooltip="EDITAR VIATURA"
                (click)="edit(entregaTable)"></button>
              <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-text p-button-lg p-button-danger" pTooltip="EXCLUIR VIATURA"
                (click)="delete(entregaTable)"></button>
            </td>
          </tr>
        </ng-template>
        <!-- <ng-template pTemplate="summary">
        <div class="flex align-items-center justify-content-between">
          Total de {{pagina.totalElements}} conciliações.
        </div>
      </ng-template> -->
      </p-table>
    </div>
  </div>

</p-card>



<p-dialog [(visible)]="dialog" [style]="{width: '700px'}" header="CADASTRO DE ENTREGAS " [modal]="true"
  styleClass="p-fluid">
  <ng-template pTemplate="content">
    <form [formGroup]="form">
      <div class="grid p-fluid">

      <div class="col-4 ">
        <label for="float-input">DATA </label>
        <input type="date" pInputText id="dataSaida" formControlName="dataSaida" name="dataSaida" />
      </div>
      <div class="col-4 ">
        <label for="float-input">HORA SAÍDA</label>
        <input type="text" pInputText id="horaSaida" formControlName="horaSaida" name="horaSaida"/>
      </div>
      <div class="col-4 ">
        <label for="float-input">HORA CHEGADA</label>
        <input type="text" pInputText id="horaRetorno" formControlName="horaRetorno" name="horaRetorno"/>
      </div>
      <div class="col-6 ">
        <label for="float-input">STATUS</label>
      <p-dropdown [options]="status" formControlName="status" inputId="status" placeholder="STATUS"
        optionLabel="label" optionValue="value" name="status"></p-dropdown>
      </div>
      <div class="col-6 ">
        <label for="float-input">RESPONSÁVEL</label>
      <p-dropdown [options]="colaboradores" placeholder="RESPONSÁVEL" formControlName="idColaboradorResponsavel" inputId="idColaboradorResponsavel"
        optionLabel="nome" optionValue="id" name="responsavel"></p-dropdown>
      </div>
      <div class="col-6 ">
        <label for="float-input">MOTORISTA</label>
      <p-dropdown [options]="colaboradores" placeholder="MOTORISTA" formControlName="idColaboradorMotorista" inputId="idColaboradorMotorista"
        optionLabel="nome" optionValue="id" name="idColaboradorMotorista"></p-dropdown>
      </div>
      <div class="col-6 ">
        <label for="float-input">VIATURA</label>
      <p-dropdown [options]="viaturas" formControlName="idViatura" inputId="idViatura" placeholder="VIATURA"
        optionLabel="placa" optionValue="id" name="idViatura"></p-dropdown>
      </div>
      <div class="col-4 ">
        <label for="float-input">Nº PEDIDO</label>
        <input type="text" pInputText id="numeroPedido" formControlName="numeroPedido" name="numeroPedido"/>
      </div>
      <div class="col-4 ">
        <label for="float-input">ODÔMETRO SAÍDA</label>
        <input type="text" pInputText id="odometrosaida" formControlName="odometroSaida" name="odometrosaida"/>
      </div>
      <div class="col-4 ">
        <label for="float-input">ODÔMETRO ENTRADA</label>
        <input type="text" pInputText id="odometroEntrada" formControlName="odometroEntrada" name="odometroEntrada"/>
      </div>
        <div class="col-12 ">
          <label for="float-input">DESCRIÇÃO</label>
          <textarea pInputTextarea pInputText id="descricao" formControlName="descricao" name="descricao"></textarea>
        </div>

       </div>
    </form>
  </ng-template>
  <ng-template pTemplate="footer">
    <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
    <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" [disabled]="!form.valid"
      (click)="manter()"></button>
  </ng-template>

</p-dialog>

<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="ball-scale-multiple">

  <p style="font-size: 20px; color: white">Carregando...</p>
</ngx-spinner>

<p-dialog header="" [(visible)]="formdataChegadaDialog" header="DIGITE HORA/MIN ">
  <ng-template pTemplate="content">
  <form  [formGroup]="form">
    <div class="col-12 md:col-12">
      <div class="p-inputgroup">
          <input type="text" pInputText placeholder="00:00" formControlName="horaRetorno" name="horaRetorno" >
          <button type="button" pButton pRipple icon="pi pi-check" class="p-button-success"  [disabled]="!form.valid"
          (click)="manter()"></button>
      </div>
  </div>

  </form>
  </ng-template>
</p-dialog>




